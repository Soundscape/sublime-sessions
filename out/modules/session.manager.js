(function(){var t,n,e,s,r,i,o,u=function(t,n){function e(){this.constructor=t}for(var s in n)c.call(n,s)&&(t[s]=n[s]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},c={}.hasOwnProperty;r=require("lodash"),i=require("hellojs"),s=require("when"),n=require("./session"),t=require("sublime-core"),o=function(t,n){return i.init(r.extend({},t),r.extend({redirect_uri:"/auth.html",oauth_proxy:"https://auth-server.herokuapp.com/proxy",scope:"friends,email"},n))},e=function(t){function e(t,n,s){var r,i,u,c;for(e.__super__.constructor.call(this),this._networks=t,this._sessions={},o(n,s),c=this._networks,r=0,i=c.length;i>r;r++)u=c[r],this.session(u)}return u(e,t),e.prototype.session=function(t){var e,s;return t?-1===this._networks.indexOf(t)?null:this._sessions[t]=this._sessions[t]||new n(t):(e=this.activeSessions(),s=this.availableSessions(),e.length>0?e[0]:s.length>0?s[0]:null)},e.prototype.authenticated=function(){var t;return t=this.session(),t?"authenticated"===t.state():!1},e.prototype.sessions=function(){return this._networks.map(function(t){return function(n){return t.session(n)}}(this))},e.prototype.availableSessions=function(){var t;return t=this.sessions().filter(function(t){return t.isAvailable()}),t.signOut=function(){return t.forEach(function(t){return t.signOut()})},t},e.prototype.inactiveSessions=function(){return this.sessions().filter(function(t){return!t.isActive()})},e.prototype.activeSessions=function(){var t;return t=this.sessions().filter(function(t){return t.isActive()}),t.signOut=function(){var n,e;return n=s.defer(),e=t.forEach(function(t){return t.signOut()}),s.all(e).then(function(){n.resolve()},function(t){n.reject()}),n.promise},t},e.prototype.signIn=function(){var t;if(t=this.session(),!t)throw new Error("No session is available");return t.signIn()},e.prototype.signOut=function(){return this.availableSessions().signOut()},e}(t.CoreObject),module.exports=e}).call(this);
